<!doctype html>
 <html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Hello World by Visual Sedimentation</title>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="../../js/_VisualSedimentation.js"></script>

    <style>@import url(../../css/fan-of-mike-style.css);</style>
    <style>@import url(../../css/jquery-ui-1.9.2.custom/css/custom-theme/jquery-ui-1.9.2.custom.css);</style>
    <script src="../../js/lib/fpsmeter/fpsmeter.js"></script>

   </head>
   <body>
      <!-- div container -->
    <header>‚Äç
    <a href="../../">Overview</a>
    <b><a style="margin-left:1em;" href="../index.html"> Examples</a></b>
    <a style="margin-left:1em;" href="../../documentation/index.html">Documentation</a></b>
    <a style="margin-left:1em;" href="https://github.com/INRIA/VisualSedimentation" target="_blank">Source</a>
    <a style="margin-left:1em;" href="" target="_blank">Contact / Feedback</a>
  </header>


      <h1>Hello World Stress test </h1>
      <!-- div container -->
      <div id="myDemo" style="width:350px;"></div>
      <!-- div panel -->
      <div id="panel" style="top:-350px;left:450px;position:relative;display:block;width:300px;height:300px;">
      <!-- div fps counter -->
      <div id="fpsmeter" style="left:180px;position:relative;display:block;"></div>
      </div>

      <!-- Create my visual sedimentation -->
      <script type="text/javascript">

        // BAR CHART SETTING (FPS @30)
        settings = {
                  options:{
                    refresh:1000/30,
                  }
                 }

        var barChart = $("#myDemo").vs(settings).data('visualSedimentation');
        var meter = new FPSMeter(document.getElementById('fpsmeter')
                                ,{
                                   graph:   1, // Whether to show history graph.
                                   history: 20, // How many history states to show in a graph.
                                   theme: 'light'
                                 });
        
        barChart.settings.draw={
          callback:{
            begin:function(_this){
              meter.tickStart();     
            },
            end:function(_this){
              meter.tick();
            }
          }
        }

      </script>

 <script>

  $(function() {
  

    // DEFINE PARAMETER TO IMPACT 
    var controlpanel = {
      targetId:"panel",
      title:"Parameters",
      control:[
                {
                  id:   "slider_TokensSeconds",
                  label:"Incomming rate",
                  unit: "token by seconds",
                  min: 1,
                  max: 100,
                  setup:function(id){
                    // return the actual token rate
                    var value = barChart.stream.getSpeed()/1000*3
                    return value
                  },
                  update:function(event,ui,self,i){
                    barChart.stream.setSpeed(barChart,1000/(ui.value/3))
                  }
                },
                {
                  id:"slider_GravityForces",
                  label:"Vertical gravity forces",
                  unit:"metters by seconds",
                  setup:function(){
                    return barChart.settings.sedimentation.world.gravity.y
                  },
                  update:function(event,ui){
                     var g = barChart.settings.sedimentation.world.gravity.y = ui.value
                     var gravity  = new barChart.phy.b2Vec2(barChart.settings.sedimentation.world.x, g);
                    barChart.world.m_gravity   = gravity;
                  }
                },
                {
                  id:"slider_Decay",
                  label:"Decay Forces",
                  unit:"",
                  min:1,
                  max:4,
                  step:0.001,
                  setup:function(){
                      return barChart.settings.sedimentation.suspension.decay.power 
                  },
                  update:function(event,ui,self){
                    barChart.settings.sedimentation.suspension.decay.power= ui.value
                  }
                },
                {
                  id:"slider_Flocullation",
                  label:"Flocullation threshold",
                  unit:"Size in pixel",
                  min:0,
                  max:4,
                  step:0.1,
                  setup:function(){
                    return  barChart.settings.sedimentation.token.size.minimum
                    //return barChart.settings.stream.refresh/1000*barChart.settings.data.model.length
                  },
                  update:function(event,ui,self){
                      barChart.settings.sedimentation.token.size.minimum = ui.value
                  },
                }
                /*
                {
                  id:"slider_PhysicsCycle",
                  label:"Physics Cycle by seconds",
                  unit:"cycle by seconds",
                  setup:function(){

                  },
                  update:function(event,ui,self){

                  }*/
                }
                
      ],
      result:{
        title:"Results",
        repport:[
                  {
                    id:"r_fps",
                    label:"Frame by seconds :",
                    update:function(){}
                  },
                  {
                    id:"r_collision",
                    label:"Total collisions",
                    update:function(){}
                  },
                  {
                    id:"r_objSeconds",
                    label:"Total collisions",
                    update:function(){}
                  }
                ]
      }
    }

    // DRAW INTERFACE 
    $("#"+controlpanel.targetId).append("<h2>"+controlpanel.title+"</h2>")


    // Slider common configuration 
    var sliderObject = []
    function sliderConfiguration(myObject,i){
      var initValue    = myObject.setup()
      // update text
      $("#"+myObject.id+"_m").text(initValue)

      if(typeof(myObject.min)=="undefined")myObject.min=0
      if(typeof(myObject.max)=="undefined")myObject.max=100
      if(typeof(myObject.step)=="undefined")myObject.step=1

      sliderObject[i] = {
                            value: initValue,
                            min:  myObject.min,
                            max:  myObject.max,
                            step: myObject.step,
                            slide: function (event, ui){
                              $("#"+myObject.id+"_m").text(ui.value)
                              return myObject.update(event,ui,myObject)
                            }
                          }

      $( "#"+myObject.id).slider(sliderObject[i]);
    }

    // Draw interface (slider + text)
    for (var i =0; i < controlpanel.control.length; i++) {
      var myObject = controlpanel.control[i]

      $("#"+controlpanel.targetId).append(
        "<div style='padding-top:10px;'>"
        +myObject.label
        +" "
        +"<div><span id='"+myObject.id+"_m' style='align:left'>"
        +0
        +"</span>&nbsp;"
        +myObject.unit
        +"</div>"
        +"</div>"
        +"<div style='padding:5px;'>"
        +"<div id='"+myObject.id+"' ></div>"
        +"</div>")
      sliderConfiguration(myObject,i)
    };


  });
  </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-30706693-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </body>   
</html>